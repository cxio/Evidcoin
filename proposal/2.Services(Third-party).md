# Services & Incentives（公共服务与激励机制）

## 1. Overview（概述）

Evidcoin 将传统区块链的单体 P2P 逻辑分解为多个独立的公共服务网络，各自专注特定职能，降低单一节点的硬件负担。各服务网络通过基网进行节点发现，并借助区块链代币的激励能力形成可持续的服务生态。

服务架构采用**基网-子网**模式：基网提供通用的节点发现能力，各子网在其之上独立组网并提供专项服务。


## 2. Service Architecture（服务架构）

### 2.1 Base Network（基网：节点发现）

- **职责**：所有 P2P 节点的自由市场，提供节点发现和广播搜寻功能。
- **通用性**：不仅服务区块链应用，也可为任意 P2P 应用提供节点发现支持。
- **外部项目**：`cxio/p2p`，不在本项目实现范围内。
- **接口需求**：本项目需设计合理的接口与基网交互。

### 2.2 Depots（数据驿站）

- **职责**：存储完整区块数据和交易附件，以 P2P 文件分享方式运行，支持大文件。
- **数据协调**：通过**紧缺性感知**机制（查询请求的跳数评估）和**数据心跳**（周期性探查）实现无中心的存储协调。
- **数据上传**：应用节点通过触发查询请求，引导驿站节点的补存行为，从而实现数据上传。
- **外部项目**：`cxio/depots`。

### 2.3 Blockqs（区块查询）

- **职责**：提供区块链交易数据的即时查询，以高性能 Web 服务方式运行，主要处理小数据请求。
- **查询能力**：
  - 脚本/脚本集：通用交易及输出项检索。
  - 交易：完整交易数据检索。
  - UTXO：未花费状态查询。
  - 交易 ID 组：按账号关联检索。
  - 附件：小于 10MB 的附件或大附件的分片索引。
- **数据来源**：实时接入区块链网络接收交易数据；初始数据通过 Depots 服务获取。
- **外部项目**：`cxio/blockqs`。

### 2.4 STUN Service（NAT 穿越服务）

- **职责**：NAT 探测和打洞服务，支持 UDP 协议的 P2P 直连。
- **通用性**：不限于区块链应用，可服务任意 P2P 节点。
- **外部项目**：`cxio/stun2p`。


## 3. Incentive Mechanism（激励机制）

### 3.1 Original Minting（原始铸币）

#### 初期铸币

| 阶段 | 年次 | 币量/块 | 说明 |
|------|------|---------|------|
| 试运行 | 第 1 年 | 10 | 逐年增加，避免早期少数用户占有过多 |
| 试运行 | 第 2 年 | 20 | |
| 试运行 | 第 3 年 | 30 | |
| 正式发行 | 第 4~5 年 | 40 | 每 2 年递减 20% |
| ... | ... | 递减 | 以**币**为单位计算，避免微量持续 |
| 终态 | 递减至 3 币/块 | 3 | 初期铸币结束 |

#### 后期铸币

持续发行 **3 币/块**，维持系统性低通胀率，保障矿工收益。

初期发行总计约 **35,590,366** 币。

### 3.2 Deflation Mechanism（通缩机制）

- 区块最终交易费总额的 **50%** 被销毁。
- 剩余 50% 计入区块收益（纳入 Coinbase 输出）。
- 动态平衡效应：交易活跃 → 销毁增加 → 币量减少 → 币值回升 → 交易降温。反之亦然。

### 3.3 Revenue Distribution（收益分配）

Coinbase 收益总额 = 铸币 + 交易费 × 50% + 兑奖截留。

分配比例：

| 受益方 | 比例 | 说明 |
|--------|------|------|
| 铸造者（校验组） | 40% | 区块校验工作的回报 |
| 铸凭者 | 10% | 提供铸凭交易的贡献者 |
| Depots | 20% | 数据存储服务 |
| Blockqs | 20% | 交易查询服务 |
| STUN | 10% | NAT 穿越服务 |

余数按除法逻辑处理，最后分配者保有余数。

### 3.4 Reward Redemption（兑奖机制）

铸造者可自由选择公共服务获奖者，但兑奖需后续铸造者确认：

- 在后续 **48** 个区块内，需至少 **2** 位铸造者确认。
- 首次确认兑现 50%，第二次确认兑现剩余 50%。
- 满足 2 个确认后，最早在 **25** 个区块后可提取。
- 48 区块内未完成确认的部分被回收（截留至第 49 号区块的 Coinbase）。

每位铸造者需评估其前段 48 个区块的 144 笔奖励（3 服务 × 48 块），通过兑奖槽位标记确认。

### 3.5 Service Evaluation（服务评估）

| 服务类型 | 评估方式 |
|----------|---------|
| STUN | 请求 NAT 探测/打洞，评估连接性、准确率、响应效率 |
| Depots | 请求随机区块/交易/附件，评估服务质量 |
| Blockqs | 与校验节点紧密连接，持续评估可用性 |

评估本质上是局部的（基于铸造者自身的观察范围），并非全网可知。


## 4. Interface Requirements（接口需求）

本项目不实现公共服务本身，但需设计以下接口：

- **节点发现接口**：与基网（`cxio/p2p`）的对接。
- **数据请求接口**：向 Depots 请求区块/附件数据。
- **查询接口**：向 Blockqs 发起交易/UTXO 查询。
- **NAT 服务接口**：与 STUN 服务的协作。
- **收益地址交换**：服务节点在连接时提供自身区块链地址的协议。


## 5. Design Parameters Summary（设计参数汇总）

```
收益分配              铸造者 50%（含铸凭者 10%）/ Depots 20% / Blockqs 20% / STUN 10%
交易费销毁比例        50%
兑奖确认数            2（48 区块内）
兑奖槽标记量          144 位/铸造者（18 字节）
兑奖最早提取          25 个区块确认后
后期铸币              3 币/块（低通胀）
```
:w
