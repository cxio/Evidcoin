# 运算指令

有两种形式的运算指令：

1. 符号指令。用符号表达，操作数在符号两侧，如：`(POP + 100)`。
2. 命名指令。有名称的指令，操作数作为实参在指令之前，如：`{100} {10} ADD`。

其中符号指令用于表达式内，命名指令则在表达式内外皆可用。


## 定义

指令码区间：`[80-103]`，24个。

```go
码值    指令字      说明
-----------------------------------------------------------
80      ()(1)       表达式封装、分组
        // 构造一个独立的运算单元，内部可含子表达式和普通指令。
        // - 普通指令可正常地取值和计算，但返回值是一个操作数，不会自动入栈也不能被截取（@, $）。
        // - 子表达式是一个优先级分组，返回值也只是一个操作数，参与运算。
        // 附参：表达式长度。
        // 实参：无。
        // 返回值：一个浮点数。
        // 规则：
        // - 数值类指令书写时无需包围花括号，就像在其它语言中的形式一样。
        // - 内部的数值会被转换到Float(float64)统一计算。
        // - 顶层表达式的返回值会自动入栈或被截取，就像一个普通指令。
        // 例：
        // ( POP + 100 )        取栈顶值，加 100
        // ((POP + $[0]) * 10)  可含子表达式，从栈顶和局域取值
        // @( POP + 100 )       顶层表达式的结果被捕获到实参区
        //
        // 设计：
        // 附参为1字节长而非变长整数，是为了限制表达式的复杂性。
        // 表达式内只有“取值+运算”的逻辑，而没有存入（栈|局域）逻辑。


// 符号指令：
// 单/双操作数，仅用于表达式内部。
81      *           乘
82      /           除
83      %           模
84      +           加，单/双操作数
85      -           减，单/双操作数
        // 例：
        // 单操作数：( -100 )
        // 双操作数：( 100 + POP * 1.5 )


// 命名指令

// 双实参：
// 支持 Int/Float 类型，返回同类型。
86      MUL         乘：MUL(x, y) => x*y
87      DIV         除：DIV(x, y) => x/y
88      ADD         加：ADD(x, y) => x+y
        // 增强：
        // - 支持 String、Bytes 的连接。
        // - 支持 Dict（map[string]any）的合并。
        // 例：
        // "Hello" "World" ADD  // "HelloWorld"

89      SUB         减：SUB(x, y) => x-y
90      MOD         模：MOD(x, y) => x%y, math.Mod(x, y)
91      POW         幂：POW(x, y) => math.Pow(x, y)
        // 例：
        // {2} {8} POW      // 256
        // {2.0} {8} POW    // 256.0
        // ( 100 + POW )    // 其中 POW 从表达式外取实参（不直观）

// 双实参：
// 支持 Int 类型，返回同类型。
92      LMOV        左移位：LMOV(x, y)  => x<<y
93      RMOV        右移位：RMOV(x, y)  => x>>y
94      AND         位与：AND(x, y)     => x&y
95      ANDX        位清空：ANDX(x, y)  => x&^y
96      OR          位或：OR(x, y)      => x|y
97      XOR         位异或：XOR(x, y)   => x^y

// 单实参：
98      NEG         取负：-x    // Int, Float
99      NOT         取反：!v    // Bool
        // 例：
        // PEEK NEG     // 取栈底项，返回其负数


// 准计算指令
// 以下指令非为严格的计算逻辑，但归入简单运算。
// 注：不可用于表达式内。

100     DIVMOD      除并求余：DIVMOD(x, y) => x/y, x%y
        // 实参1：支持 Int/Float
        // 实参2：支持 Int/Float
        // 返回值：2个，自动展开到目标空间。

101     REP(1)      重复
        // 复制目标数据为多项（重复）。
        // 附参：重复的份数。
        // 实参：目标项。
        // 返回值：重复的条目序列。
        // 会自动展开到接受域（数据栈|实参区|局部域）。
        // 例：
        // REP[1]   取出栈顶项重复1份，没有意义。
        // REP[2]   取出栈顶项重复2份。效果同 TOP。
        // REP      取出栈顶项，但零重复。
        //          相当于移除栈顶项，外观上违反直觉，需留意！
        // REP[3]   这才开始有意义……
        // 注：
        // 适用任意类型，但仅为浅复制。

102     DEL         删除
        // 删除字典（map[string]any）内的某个条目。
        // 实参1：目标集。
        // 实参2：键名（字符串）或键名序列。
        // 返回值：原目标集引用。
        // 例：
        // "abc" DEL        // 移除目标字典内的 abc 项
        // {"A", "B"} DEL   // 移除目标字典内的 A、B 两项

103     CLEAR       清空
        // 将字典内容清空。
        // 实参：目标字典。
        // 返回值：原目标（已空）。
```
