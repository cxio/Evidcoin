# 集合指令

支持可迭代集合（切片或字典）的一些基本操作。

> **安全性：**
> 源脚本应当只读，所以需要注意有写入逻辑的指令应当在一个副本上操作。


## 定义

指令码区间：`[36-45]`，10个。

```go
码值    指令字      说明
-----------------------------------------------------------
36      SLICE(1)    子切片
        // 从目标切片创建一个子切片。
        // 注意是在原切片上截取引用，创建副本应使用COPY。
        // 附参：子切片大小（<256），0表示目标位置后全部。
        // 实参1：目标切片。
        // 实参2：起始下标（从0开始），支持负数从末尾算起。
        // 返回值：一个子切片。
        // 例：
        // 假设目标集：[1, 2, 3, 4, 5, 6, 7, 8]
        //      {2} SILCE[3]    // [3, 4, 5]
        //      {-4} SLICE[2]   // [5, 6]
        //      {-3} SLICE      // [6, 7, 8]
        //      {8} SLICE       // [] 空切片
        // 注意：
        // 指令遵循严格模式，如果位置或数量溢出，执行会失败。

37      REVERSE     反转（切片）
        // 将切片内的成员反转排列。
        // 实参：目标切片。
        // 返回值：反转后的新切片。
        // 例：
        // {1, 2, 3, 4, 5}
        // REVERSE  // [5, 4, 3, 2, 1]

38      MERGE       合并（切片）
        // 将多个切片合并为一个切片。
        // 实参：不定数量。
        // 返回值：一个新切片。
        // 例：
        // {1, 2, 3}
        // {10, 20}
        // @POP @POP MERGE  // [10, 20, 1, 2, 3]

39      EXTEND      扩充（切片）
        // 向目标切片内添加成员。
        // 实参：不定数量，首个为目标集，其余为待添加成员。
        // 返回值： 一个新切片。
        // 例：
        // {1, 2, 3}
        // {10} {20}
        // @POPS[3] EXTEND  // [1, 2, 3, 10, 20]

40      PACK        封装（压实打包）
        // 将切片成员解码串接在一起。
        // 压实打包，成员之间底层数据紧密集成。
        // 实参：一个切片。
        // 返回值：一个字节序列。
        // 例：
        // POPS[3] PACK 将栈顶3项数据解码打包为一体。
        // 注：
        // 成员可以是多种类型混杂，会解码到基础类型串接。

41      SPREAD      展开（切片）
        // 将目标切片展开，成员提升。
        // 如果前置取值指令，会展开添加到目标空间。
        // 实参：一个切片。
        // 返回值：不定数量成员。
        // 例：
        // $SPREAD  将目标集展开添加到当前局部域。
        // @SPREAD  将目标集展开添加到实参区。
        // SPREAD   将栈顶项展开后逐个入栈（维持原顺序）。
        // 提示：
        // 连续的 @~SPREAD 可将栈内多个切片逐一展开到实参区。

42      SET         设置（字典）
        // 设置字典（map[string]any）的键值对应。
        // 实参1：目标字典。
        // 实参2：键名或键名集（[]string）。
        // 实参3：目标值或值集。
        // 返回值：原目标字典。
        // 说明：
        // 如果键为一个字符串（键名），则值任意。
        // 如果键为一个清单，同时值也是一个清单，则一一对应赋值，
        // 否则同一个值对应全部键名。
        //
        // 设计：
        // 字典并不是栈脚本中的主要集合类型，
        // 但在转换指令系中，支持由两个切片创建字典，以提供某些方便。

43      ITEM        条目（字典）
        // 获取集合中的成员或成员集。
        // 实参1：目标字典。
        // 实参2：成员键或键集。
        // 返回值：值或值集。
        // 说明：
        // 如果键名对应的条目不存在，会取到一个默认零值（nil）。
        // 如果键名是一个集合，则返回一个值集。
        // 例：
        // "AAA" ITEM           获取目标集内 AAA 对应的值。
        // {"AA", "BB"} ITEM    获取目标集内 AA 和 BB 的值。

44      INDEX       成员（切片）
        // 获取目标切片的成员或成员集。
        // 实参1：目标切片。
        // 实参2：位置下标或下标集。
        // 返回值：值或值集。
        // 说明：
        // 切片的数值下标支持负数从末尾算起。
        // 如果位置是一个下标集，则返回一个值集。
        // 例：
        // {1} INDEX    取切片中的第二个成员
        // {1, 3} INDEX 取切片中第二和第四个成员。
        //
        // 设计：
        // 主要用于取切片中单个值或不连续位置的值。

45      SIZE        大小（切片|字典）
        // 获取集合的大小。
        // 实参：一个集合。
        // 返回值：一个整数。
```
