# 栈操作指令

对数据栈中的条目直接进行操作：入栈、出栈、引用、转移等。通常会配合截取指令（`@`、`$`）使用。


## 定义

指令码区间：`[25-35]`，11个。

```go
码值    指令字      说明
-----------------------------------------------------------
25      NOP         无操作
        // 实参：不定数量。
        // 无任何操作，但会读取实参区（清空）。
        // 返回值：无。
        // 例：
        // @SHIFT[] NOP 提取数据栈全部，然后读取（清空）。
        // @SHIFT NOP   同上。零值附参可省略中括号。
        // @POP NOP     移除栈顶项。
        //
        // 设计：
        // 不定数量实参包含0个，因此无需访问数据栈。

26      PUSH        数据入栈
        // 把实参区成员顺序压入数据栈。
        // 如果实参区为空，这就只是一个空操作（无意义）。
        // 实参：不定数量。
        // 返回值：无。
        // 例：
        // $[0] $[1] $[2] PUSH  将局部域3个值压入到数据栈。
        // @PEEK @INPUT PUSH    提取栈底项和输入缓冲区数据，压入数据栈。


// 以下指令返回多项时，原样展开。

27      POP         弹出栈顶项
        // 返回值：栈顶项。
        // 通常前置截取指令使用，否则返回值重新入栈无意义。
        // 例：
        // @POP     弹出栈顶项到实参区。
        // $POP     弹出栈顶项添加到当前局部域。
        // POP      无意义。

28      POPS(1)     弹出栈顶多项
        // 附参：弹出的条目数（<256）。0表示全部。
        // 如果条目数超出栈高度，执行会失败（严格约束）。
        // 返回值：原始序列。
        // 例：
        // @POPS[4] 弹出栈顶4项添加到实参区。
        // $POPS    弹出栈内全部条目添加到当前局部域。
        // POPS[4]  无意义。

29      TOP         引用栈顶项
        // 返回值：栈顶项。
        // 类似POP，通常结合截取指令使用，但无前置截取也有意义。
        // 例：
        // @TOP 引用栈顶项到实参区（浅复制）。
        // $TOP 引用栈顶项添加到当前局部域。
        // TOP  引用栈顶项，返回值自动入栈（复制了一份）。

30      TOPS(1)     引用栈顶多项
        // 附参：引用条目数（<256）。0表示全部。
        // 如果条目数超出栈高度，执行会失败（严格约束）。
        // 返回值：原始序列。
        // 例：
        // $TOPS[3] 引用栈顶3项，逐一添加到当前局部域。
        // @TOPS[]  引用栈内全部条目，添加到实参区。
        // @TOPS    同上。
        //
        // 提示：
        // 与后面运算指令 REP 的区别：
        // REP[n]   取出栈顶1项复制n次，展开入栈。
        // TOP[n]   引用栈顶n项（原样复制1次），展开入栈。


// 以下2指令由实参指定位置。
// 注：自动展开能力依旧。

31      PEEK        引用栈内任意位置条目
        // 实参：目标位置。可选，默认0值（栈底）。
        // 返回值：目标项。
        // 说明：
        // 从栈底开始计算，支持负数从栈顶算起。
        // 例：
        // PEEK         引用栈底项，自动入栈（克隆栈底项到栈顶）。
        // @{0} PEEK    同上引用，明确位置。
        // @PEEK        同上引用，添加到实参区。
        // @{-1} PEEK   引用栈顶项，自动入栈（同 TOP）。

32      PEEKS(1)    引用栈内任意位置段条目
        // 附参：引用条目数。0表示目标位置之后全部。
        // 实参：起始位置。可选，默认0值。
        // 返回值：条目序列。
        // 说明：
        // 从栈底开始计数，支持负值从栈顶算起。
        // 如果位置下标超出栈高度，或实际数量不足，执行会失败。
        // 例：
        // @PEEKS[5]        引用栈底5项数据展开到实参区。
        // @{1} @PEEKS[2]   从第二项开始引用栈底2项，展开到实参区。
        // PEEKS[5]         引用栈底5项展开入栈（克隆栈底5项到栈顶）。


// 以下指令返回一个切片（无自动展开）。

33      SHIFT(1)    移出栈顶条目
        // 移出栈顶目标数量的条目。
        // 附参：条目数（<256），0表示全部。
        // 如果条目数超出栈高度，执行会失败（严格）。
        // 返回值：一个切片。
        // 例：
        // @SHIFT[4]    移出栈顶4项，打包为一个切片放入实参区。
        // $SHIFT[4]    同上但添加到当前局部域。
        // SHIFT[0]     移出栈内全部条目，封装为一个切片入栈。
        // SHIFT        同上。

34      CLONE(1)    克隆栈顶条目
        // 克隆栈顶目标数量的条目（浅复制）。
        // 附参：条目数（<256），0表示全部。
        // 返回值：一个切片。
        // 例：
        // @CLONE[3]    克隆栈顶3项，打包为一个切片放到实参区。
        // $CLONE[3]    同上克隆，但添加到当前局部域。
        // CLONE[3]     克隆栈顶3项打包为一个切片入栈。
        // CLONE        克隆栈内全部条目，打包为一个切片入栈。


// 以下指令由实参指定位置。

35      VIEW(1)     引用栈条目
        // 附参：引用条目数。0值表示目标位置之后全部。
        // 实参：起始位置。可选，默认0值。
        // 返回值：一个Any切片。
        // 说明：
        // 从栈底开始计算，支持负值从栈顶算起。
        // 如果位置下标超出栈高度，或实际数量不足，执行会失败。
        // 例：
        // @VIEW[5]     引用栈底5项打包为一个切片，放入实参区。
        // VIEW[5]      引用栈底5项打包为一个切片入栈。
        // @{-5} VIEW   引用栈顶5项打包为一个切片入栈，同 CLONE[5]
```